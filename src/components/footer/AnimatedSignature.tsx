"use client";

import { useEffect, useRef } from "react";

type Props = {
  className?: string;
  baseDuration?: number;     
  gap?: number;             
  threshold?: number;        
};

const pathOrder = [
  "Elu1","Elu2","Elu3","EluL1","EluU1","EluU2",
  "ManceboM1","ManceboM2","ManceboM3","ManceboAn1",
  "ManceboN1","ManceboN2","ManceboCe1","ManceboC2",
  "pathMancebo","ManceboO1","Rubrica1","Rubrica2","Rubrica3",
];

export default function AnimatedSignature({
  className = "",
  baseDuration = 0.20,
  gap = 0.20,
  threshold = 0.30,
}: Props) {
  const rootRef = useRef<HTMLDivElement | null>(null);

  useEffect(() => {
    const root = rootRef.current;
    if (!root) return;

    
    const prepare = () => {
      for (const id of pathOrder) {
        const el = root.querySelector<SVGPathElement>(`#${id}`);
        if (!el) continue;

        const length = el.getTotalLength();
        el.style.strokeDasharray = `${length}`;
        el.style.strokeDashoffset = `${length}`;
        el.style.animation = "none";
      }
    };

   
    const run = () => {
      let delay = 0;

      for (const id of pathOrder) {
        const el = root.querySelector<SVGPathElement>(`#${id}`);
        if (!el) continue;

        el.style.animation = `firma-write ${baseDuration}s linear forwards`;
        el.style.animationDelay = `${delay}s`;

        delay += baseDuration + gap;
      }
    };

    prepare();

    const svg = root.querySelector("svg");
    if (!svg) return;

    const obs = new IntersectionObserver(
      (entries) => {
        for (const entry of entries) {
          if (entry.isIntersecting) {
            prepare();
            run();
            obs.disconnect();
            break;
          }
        }
      },
      { threshold }
    );

    obs.observe(svg);

    return () => obs.disconnect();
  }, [baseDuration, gap, threshold]);
return (
    <div ref={rootRef} className={className}>
      
      <svg
        id="firma-elu"
        viewBox="0 0 241 166"
        xmlns="http://www.w3.org/2000/svg"
        className="h-auto w-32 sm:w-40"
      >

        <g id="Elu">
        <path id="Elu1" className="firma-path" d="m 66.217133,43.824492 9.698744,-3.653755"/>
          <path id="Elu2" className="firma-path" d="m 89.103212,38.709234 c -1.839411,-0.6088 -3.896891,-1.388478 -7.460608,-0.886165 -2.936929,0.413959 -4.944844,0.80886 -6.672458,2.75973 -2.181498,2.463397 -3.82193,5.916847 -5.891833,8.671615 -1.640252,2.182954 -2.522472,3.506387 -3.802388,5.76586 -1.279036,2.257923 -2.03926,5.499398 -1.087712,8.502574 2.84518,8.979649 13.198475,4.429744 18.191911,0.592002 2.404183,-1.847751 5.137265,-4.104436 6.618024,-4.870133"/>
          <path id="Elu3" className="firma-path" d="M 85.372926,51.862755 C 80.47064,53.122173 69.434778,54.175298 65.040211,54.785759"/>
          <path id="EluL1" className="firma-path" d="m 108.5007,33.593976 c -8.579593,-2.095835 -13.969827,11.020097 -18.393629,21.922535 -0.672645,1.657726 -1.332172,3.140882 -1.276032,5.093112 0.05978,2.078386 1.075566,3.894859 3.359716,3.69039 2.573596,-0.230378 4.420853,-1.652228 6.270139,-3.350058 1.083655,-0.994904 2.404706,-2.57174 3.649386,-4.204711 1.36536,-1.791294 2.63881,-3.650136 3.40619,-4.882489"/>
          <path id="EluU1" className="firma-path" d="m 98.854491,61.090207 c 1.735679,4.065417 6.479859,6.168497 10.646559,2.037105 2.38165,-2.361455 3.10516,-5.447305 4.96812,-8.341553"/>
          <path id="EluU2" className="firma-path" d="m 109.99281,63.554771 c 2.71825,1.595725 4.71578,1.914109 8.20668,0.217411 4.68657,-2.277839 6.96975,-3.844895 11.19082,-6.063419"/>
        </g>
         {/* MANCEBO (M y n en subpaths) */}
        <g id="Mancebo">
          {/*-- M en tres subpaths */}
          <path id="ManceboM1" className="firma-path" d="m 29.418622,132.97613 c 4.336683,-8.51493 10.68001,-15.75356 16.282145,-23.43044 m 0,0 c 5.211569,-6.78342 10.516466,-13.561624 14.520495,-21.154075 m 0,0 c 1.574019,-2.51346 3.49999,-5.263002 6.471545,-6.148093 m 0,0 c 3.652691,-0.213819 4.312089,4.249498 4.273146,7.021333 m 0.179349,1.055398 c -0.878387,8.804474 -4.920779,17.396607 -8.900155,25.117847" />
          <path id="ManceboM2" className="firma-path" d="m 70.965953,89.264855 c -0.385257,2.686232 1.397671,1.196563 2.327201,0.111267 m 0,0 2.969486,-3.130841 m -2.378487,1.844632 c 6.21467,-5.298053 4.683137,5.272371 8.805814,4.037292 m -1.488692,0.159479 c -0.467877,7.591423 -5.133063,11.149826 -5.527095,18.766906"/>
          <path id="ManceboM3" className="firma-path" d="m 82.689967,92.127205 c 5.333484,-2.171746 6.945354,1.486191 6.237916,4.189742 m 0,0 c -0.394978,5.138553 -1.444931,10.356103 -4.301015,14.736643"/>
          {/*a de Mancebo */}
          <path id="ManceboAn1" className="firma-path" d="m 100.88258,104.97253 c -3.874843,4.64255 -10.622726,6.88412 -13.323964,2.08058 m -0.882742,0.0861 c -2.212256,1.35645 4.726928,-6.14417 7.658295,-8.217908 2.271277,-1.606772 4.747839,-4.119841 6.723401,-2.435545 1.4258,1.21558 0.2822,4.249043 -0.0747,5.798873 -0.45235,1.96405 -1.45263,4.89347 0.1925,6.67188 5.34589,5.77896 11.27898,-8.57361 12.54779,-11.787237"/>
          {/*n en dos subpaths  */}
          <path id="ManceboN1" className="firma-path" d="m 109.47271,105.6288 c 1.22021,-2.45152 2.78568,-5.16383 3.88148,-7.293263 -2.22316,11.877243 1.39685,10.013083 2.6376,8.755363 0.90771,1.03127 5.40645,-12.598207 2.95586,-7.643379 0.13152,1.680309 -0.63172,6.146479 -0.85322,7.816169"/>
          <path id="ManceboN2" className="firma-path" d="m 119.15569,100.7114 c -0.51995,1.96641 -1.12774,3.95615 -1.01368,6.01585 0.0659,1.01526 -0.0875,2.30558 0.8478,2.98156 1.02334,0.61188 2.27674,0.1641 3.29863,-0.22258 1.75552,-0.74761 3.33688,-1.83793 5.0524,-2.66862 0.55213,-0.28919 1.10552,-0.5762 1.65022,-0.87927"/>
          {/*-- Resto de Mancebo */}
          <path id="ManceboCe1" className="firma-path" d="m 136.81937,97.132099 c -8.41945,-2.421177 -10.64782,9.458171 -3.60221,11.638271 3.48479,1.07829 8.15428,-1.55534 9.61451,-3.25948 1.38729,-1.61904 1.29571,-2.8615 2.41844,-4.65228 1.79854,-2.86869 4.26843,-4.272304 8.01408,-3.689287 -2.59708,4.454557 -9.02555,7.984127 -12.02102,9.772067"/>
          <path id="ManceboC2" className="firma-path" d="m 143.27121,105.31927 c 4.81071,6.46178 11.01327,1.5294 15.21539,0.61907"/>
          <path id="pathMancebo" className="firma-path" d="m 160.85075,102.8292 c 5.94218,-3.741863 16.70106,-4.582058 13.4884,0.0278 -2.78704,3.99913 -9.9086,9.02691 -13.79044,5.39828 -2.65993,-2.48643 -0.48765,-6.9397 0.50825,-9.624489 2.67177,-7.202661 5.35295,-14.183007 9.3665,-20.461027"/>
          <path id="ManceboO1" className="firma-path" d="m 173.56534,98.593597 c 3.78243,-2.185608 7.11678,-2.57949 11.77304,-2.085173 7.40465,0.786098 6.31244,7.462286 1.42079,11.317746 -3.08458,2.43119 -6.54562,1.19112 -5.85139,-2.63522 0.64466,-3.55307 2.44403,-5.957286 2.94477,-8.021627"/>
        </g>
        {/*-- RUBRICA */}
        <g id="Rubrica">
          <path id="Rubrica1" className="firma-path" d="m 71.197887,126.39951 c 9.434537,-1.18962 28.608495,-1.46149 38.616413,-1.46151"/>
          <path id="Rubrica2" className="firma-path" d="m 156.24842,121.28425 c -5.47221,0 -18.26689,0.89692 -26.112,1.78252 -4.21573,0.47572 -9.34053,1.33303 -13.42904,1.71085 -3.17355,0.29327 -5.43146,-0.0829 -8.95269,0.52946 -4.58114,0.79669 -5.55629,2.0656 -9.69874,2.83136 -4.742881,0.87675 -8.289601,0.90801 -12.682973,1.34823 -8.923483,0.89415 -24.83949,3.20341 -30.588352,6.41295 5.699792,2.60229 16.992207,0.56881 27.604122,0.0756 3.383931,-0.15734 5.739266,6.2e-4 8.95269,-0.10504 3.359548,-0.11047 6.259481,-0.65828 9.698743,-0.69578 5.88076,-0.0646 12.70807,-0.006 17.90537,-0.006 3.31167,0 9.56257,-0.0995 12.68299,0.5536 4.12498,0.86336 4.55525,0.84992 8.95269,1.63866"/>
          <path id="Rubrica3" className="firma-path" d="m 139.81415,137.3606 c -8.47035,3.86606 -29.81957,4.18675 -42.504301,5.61752 -5.223506,0.58917 -7.880753,0.80081 -11.936922,1.68998"/>
        </g>

        
      </svg>
    </div>
  );
}
       
